<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>What is metaclass | oyzy</title>
  <meta name="keywords" content=" python ">
  <meta name="description" content="What is metaclass | oyzy">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:type" content="article">
<meta property="og:title" content="Hello World">
<meta property="og:url" content="http://youngziyi.github.io/2020/03/25/hello-world/">
<meta property="og:site_name" content="oyzy">
<meta property="og:description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-25T15:50:42.502Z">
<meta property="article:modified_time" content="2020-03-25T08:30:50.146Z">
<meta property="article:author" content="Ouyang Ziyi">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 4.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>Ouyang Ziyi</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/YoungZiyi" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(14)</small></div></li>
    
        
            
            <li><div data-rel="C">C<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="网络">网络<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="algorithm">algorithm<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="框架">框架<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="raspberry">raspberry<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="python">python<small>(3)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="epoll">epoll<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="计算机基础">计算机基础<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="数据结构">数据结构<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="PEP">PEP<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="14">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="Search..." />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color2">C</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">读书笔记</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">python</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">应用技术</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">raspberry</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">epoll</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">algorithm</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">翻译</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="C "
           href="/2016/11/25/How-to-read-statement-in-C/"
           data-tag="C"
           data-author="" >
            <span class="post-title" title="How to read statement in C">How to read statement in C</span>
            <span class="post-date" title="2016-11-25 11:11:11">2016/11/25</span>
        </a>
        
        <a  class="网络 "
           href="/2017/11/23/IP%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84%E5%8F%8A%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/"
           data-tag="读书笔记"
           data-author="" >
            <span class="post-title" title="IP地址结构及子网划分">IP地址结构及子网划分</span>
            <span class="post-date" title="2017-11-23 22:57:11">2017/11/23</span>
        </a>
        
        <a  class="algorithm "
           href="/2017/03/14/Max-Sum-Subset-Problem/"
           data-tag="python"
           data-author="" >
            <span class="post-title" title="Max Sum Subset Problem">Max Sum Subset Problem</span>
            <span class="post-date" title="2017-03-14 11:11:11">2017/03/14</span>
        </a>
        
        <a  class="框架 "
           href="/2018/10/24/PHP%E6%A1%86%E6%9E%B6%E7%9A%84%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0%E6%B5%85%E6%9E%90/"
           data-tag="应用技术"
           data-author="" >
            <span class="post-title" title="PHP框架的路由实现浅析">PHP框架的路由实现浅析</span>
            <span class="post-date" title="2018-10-24 23:15:11">2018/10/24</span>
        </a>
        
        <a  class="raspberry "
           href="/2016/06/14/Raspberry-pi-%E7%9B%B4%E8%BF%9EUbuntu%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0%E6%9C%AC/"
           data-tag="raspberry"
           data-author="" >
            <span class="post-title" title="Raspberry pi 直连Ubuntu系统笔记本">Raspberry pi 直连Ubuntu系统笔记本</span>
            <span class="post-date" title="2016-06-14 14:09:00">2016/06/14</span>
        </a>
        
        <a  class="python "
           href="/2016/10/31/What-is-metaclass/"
           data-tag="python"
           data-author="" >
            <span class="post-title" title="What is metaclass">What is metaclass</span>
            <span class="post-date" title="2016-10-31 11:11:11">2016/10/31</span>
        </a>
        
        <a  class=""
           href="/2020/03/25/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2020-03-25 23:50:42">2020/03/25</span>
        </a>
        
        <a  class="python "
           href="/2017/08/05/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/"
           data-tag="python"
           data-author="" >
            <span class="post-title" title="python多线程编程">python多线程编程</span>
            <span class="post-date" title="2017-08-05 11:11:11">2017/08/05</span>
        </a>
        
        <a  class="python "
           href="/2017/07/27/python%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0II/"
           data-tag="读书笔记"
           data-author="" >
            <span class="post-title" title="python源码解析 读书笔记II">python源码解析 读书笔记II</span>
            <span class="post-date" title="2017-07-27 22:03:11">2017/07/27</span>
        </a>
        
        <a  class="epoll "
           href="/2018/05/11/select-poll-epoll-%E5%88%9D%E6%8E%A2/"
           data-tag="epoll"
           data-author="" >
            <span class="post-title" title="select poll epoll 初探">select poll epoll 初探</span>
            <span class="post-date" title="2018-05-11 11:11:11">2018/05/11</span>
        </a>
        
        <a  class="计算机基础 "
           href="/2017/12/19/%E5%8E%9F%E7%A0%81-%E5%8F%8D%E7%A0%81-%E8%A1%A5%E7%A0%81/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="原码、反码、补码学习">原码、反码、补码学习</span>
            <span class="post-date" title="2017-12-19 16:57:11">2017/12/19</span>
        </a>
        
        <a  class="数据结构 "
           href="/2017/08/24/%E6%95%A3%E5%88%97/"
           data-tag="读书笔记"
           data-author="" >
            <span class="post-title" title="散列">散列</span>
            <span class="post-date" title="2017-08-24 22:32:11">2017/08/24</span>
        </a>
        
        <a  class=""
           href="/2017/03/19/%E9%93%BE%E8%A1%A8%E5%AE%9E%E7%8E%B0%E5%A4%9A%E9%A1%B9%E5%BC%8F%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/"
           data-tag="algorithm"
           data-author="" >
            <span class="post-title" title="链表实现多项式及相关操作">链表实现多项式及相关操作</span>
            <span class="post-date" title="2017-03-19 18:15:06">2017/03/19</span>
        </a>
        
        <a  class="PEP "
           href="/2017/08/24/PEP-333%E2%80%94%E2%80%94Python-Web%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BD%91%E5%85%B3%E6%8E%A5%E5%8F%A3/"
           data-tag="翻译"
           data-author="" >
            <span class="post-title" title="PEP333——Python Web服务器网关接口">PEP333——Python Web服务器网关接口</span>
            <span class="post-date" title="2017-08-24 22:32:11">2017/08/24</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-What-is-metaclass" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">What is metaclass</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a  data-rel="python">python</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color2">python</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2020-03-25 23:12:21'>2016-10-31 11:11</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#What-is-metaclass"><span class="toc-text">What is metaclass?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#python中的class也是对象"><span class="toc-text">python中的class也是对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态的创建class"><span class="toc-text">动态的创建class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是metaclass呢？"><span class="toc-text">什么是metaclass呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#metaclass属性"><span class="toc-text">metaclass属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定制metaclass"><span class="toc-text">定制metaclass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么使用metaclass-class而不是function？"><span class="toc-text">为什么使用metaclass class而不是function？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么使用metaclass？"><span class="toc-text">为什么使用metaclass？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写在最后"><span class="toc-text">写在最后</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="What-is-metaclass"><a href="#What-is-metaclass" class="headerlink" title="What is metaclass?"></a>What is metaclass?</h1><p>Reference: <a href="http://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python/6581949#6581949" target="_blank" rel="noopener">answer on stackoverflow</a></p>
<h2 id="python中的class也是对象"><a href="#python中的class也是对象" class="headerlink" title="python中的class也是对象"></a>python中的class也是对象</h2><p>大多数的语言中，class是一段描述如何创建对象的代码，python也是这样，不过python中的class不仅仅是这样，它本身也是一个对象。<br>作为一个对象，你就能对它进行如下操作:  </p>
<ul>
<li>将class对象赋给一个变量  </li>
<li>复制它  </li>
<li>给它添加属性  </li>
<li>可以将它作为一个参数传递给一个函数  </li>
</ul>
<h2 id="动态的创建class"><a href="#动态的创建class" class="headerlink" title="动态的创建class"></a>动态的创建class</h2><p>你可以随意的创建一个class，就想任何其他对象一样的。你可以在函数中创建一个对象并将它返回，这并不是很‘动态’，因为这样只不过class的定义写进函数中而已，<br>当你使用class关键字时，python就会自动创建一个class对象。python提供了一个手动创建class对象的方法——<code>type()</code>  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type(object)    <span class="comment"># 返回对象的type</span></span><br></pre></td></tr></table></figure>
<p>以上是我们熟悉的用法，但是<code>type()</code>还有一个功能——创建class对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type(classNamem classParentTuple, classAttributeDictionary)    <span class="comment"># 返回一个新的type（class对象）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Foo = type(<span class="string">'Foo'</span>, (), &#123;<span class="string">'bar'</span>:<span class="number">1</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = Foo()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(f)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__main__.Foo</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.bar</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>给class对象绑定方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">echoBar</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(self.bar)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Foo = type(<span class="string">'Foo'</span>, (), &#123;<span class="string">'bar'</span>:<span class="number">1</span>, <span class="string">'echoBar'</span>:echoBar&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = Foo()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.echoBar()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="什么是metaclass呢？"><a href="#什么是metaclass呢？" class="headerlink" title="什么是metaclass呢？"></a>什么是metaclass呢？</h2><p><strong><em>任何对象都是由class或metaclass所创建的，class对象就是由metaclass创建的</em></strong>  </p>
<blockquote>
<p><code>type</code>类似于<code>str</code>（用来创建string实例的class），<code>int</code>（创建整数对象的class），它就是python用来创建所有class对象的metaclass<br><code>type</code>是内置的metaclass，你也可以创建自己的metaclass  </p>
</blockquote>
<h2 id="metaclass属性"><a href="#metaclass属性" class="headerlink" title="metaclass属性"></a><strong>metaclass</strong>属性</h2><p>通过设置class的<code>__metaclass__</code>属性来指定创建class对象所使用的metaclass，<strong>metaclass</strong>的值可以是任何可调用的对象，包括函数，<br>python会去查找<strong>metaclass</strong>所指定的对象，如果找不到，python将会使用<code>type</code>来创建class对象。查找的顺序是1.在class内部查找；2.在模块内查找；<br>3.在父类中查找  </p>
<blockquote>
<p>小心！<code>__metaclass__</code>属性不会被继承！metaclass所指定的对象必须要能创建一个class对象！  </p>
</blockquote>
<h2 id="定制metaclass"><a href="#定制metaclass" class="headerlink" title="定制metaclass"></a>定制metaclass</h2><p>使用metaclass的目的是在创建class对象的时候做一些操作，就想在创建类实例的时候，自动调用<strong>init</strong>来做一些操作。<br>举一个‘愚蠢’的例子来说明，在创建class对象的时候自动将所有自定义的attribute改成大写字母（显然没什么卵用），现在我们来通过设置metaclass来实现该目的。<br><em>通过函数</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upper_case</span><span class="params">(futrue_class_name, futrue_class_parent, future_class_attribute)</span>:</span></span><br><span class="line">    uppercase_attr = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> name, val <span class="keyword">in</span> futrue_class_attribute.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> name.startswith(<span class="string">'__'</span>):</span><br><span class="line">            uppercase_attr[name.upper()] = val</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            uppercase_attr[name] = val</span><br><span class="line">            <span class="keyword">return</span> type(futrue_class_name, futrue_class_parent, uppercase_attr)</span><br><span class="line"><span class="comment">### python2.x</span></span><br><span class="line">__metaclass__ = upper_case</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">()</span>:</span></span><br><span class="line">    bar = <span class="number">1</span></span><br><span class="line">print(hassattr(Foo, <span class="string">'bar'</span>))    <span class="comment"># return False</span></span><br><span class="line">print(hassattr(Foo, <span class="string">'BAR'</span>))    <span class="comment"># return True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### python3.x    (documetation)[https://docs.python.org/3/library/2to3.html?highlight=metaclass#2to3fixer-metaclass]</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(metaclass=upper_case)</span>:</span></span><br><span class="line">    bar = <span class="number">1</span></span><br><span class="line">print(hassattr(Foo, <span class="string">'bar'</span>))    <span class="comment"># return False</span></span><br><span class="line">print(hassattr(Foo, <span class="string">'BAR'</span>))    <span class="comment"># return True</span></span><br></pre></td></tr></table></figure>
<p><em>通过class</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpperAttrMetaclass</span><span class="params">(type)</span>:</span></span><br><span class="line">    uppercase_attr = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(uperattr_metaclass, futrue_class_name, futrue_class_parent, future_class_attribute)</span>:</span></span><br><span class="line">    <span class="comment"># def __new__(cls, clsname, bases, dct):    # this is production code</span></span><br><span class="line">        <span class="keyword">for</span> name, val <span class="keyword">in</span> future_class_attribute.items():</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> name.startswith(<span class="string">'__'</span>):</span><br><span class="line">                uppercase_attr[name.upper()] = val</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                uppercase_attr[name] = val</span><br><span class="line">                <span class="keyword">return</span> type(futrue_class_name, futrue_class_parent, uppercase_attr)</span><br><span class="line">        <span class="keyword">return</span> type(future_class_name, future_class_parents, uppercase_attr)</span><br><span class="line">        <span class="comment"># or</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(future_class_name, future_class_parents, uppercase_attr)    <span class="comment"># this is much OOP</span></span><br><span class="line">        <span class="comment"># or even cleaner</span></span><br><span class="line">        <span class="keyword">return</span> super(UpperAttrMetaclass, cls).__new__(cls, clsname, bases, uppercase_attr)</span><br><span class="line"><span class="comment">### python2.x</span></span><br><span class="line">__metaclass__ = UpperAttrMetaclass</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">()</span>:</span></span><br><span class="line">    bar = <span class="number">1</span></span><br><span class="line">print(hassattr(Foo, <span class="string">'bar'</span>))    <span class="comment"># return False</span></span><br><span class="line">print(hassattr(Foo, <span class="string">'BAR'</span>))    <span class="comment"># return True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### python3.x    (documetation)[https://docs.python.org/3/library/2to3.html?highlight=metaclass#2to3fixer-metaclass]</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(metaclass=UpperAttrMetaclass)</span>:</span></span><br><span class="line">    bar = <span class="number">1</span></span><br><span class="line">print(hassattr(Foo, <span class="string">'bar'</span>))    <span class="comment"># return False</span></span><br><span class="line">print(hassattr(Foo, <span class="string">'BAR'</span>))    <span class="comment"># return True</span></span><br></pre></td></tr></table></figure>
<p><code>__new__</code>和<code>__init__</code>差不多，后者是在创建实例时自动被调用，前者则是在创建class对象是被调用，<code>__new__</code>中第一个参数是class对象本身，<br>就像class方法第一个参数self是实例本身一样，定义如此，不必在意<br>好了，这就是所有有关metaclass的概念了  </p>
<h2 id="为什么使用metaclass-class而不是function？"><a href="#为什么使用metaclass-class而不是function？" class="headerlink" title="为什么使用metaclass class而不是function？"></a>为什么使用metaclass class而不是function？</h2><p><strong>metaclass</strong>属性可以是任何可调用的对象，那为什么要使用class，而不是function呢？class明显要复杂的多，自己找虐吗？  </p>
<ul>
<li>使用class使目的更明显  </li>
<li>可以使用OOP思想，使metaclass可以继承于其它metaclass，覆盖父类中的方法，甚至metaclass中还可以使用metaclass！  </li>
<li>可以使你的代码结构更清晰，简单的代码用不着metaclass，而复杂的代码中使用class来作为metaclass可以将一组方法group起来，使代码更加易读  </li>
<li>可以hook on <code>__new__``__init__``__call__</code>，你可以将所有的操作都放在<code>__new__</code>方法中（因为它是最先调用的方法），但是分开操作更有意义一些  </li>
<li>metaclass之所以叫metaclass这是有原因的！use class and shut up!  </li>
</ul>
<h2 id="为什么使用metaclass？"><a href="#为什么使用metaclass？" class="headerlink" title="为什么使用metaclass？"></a>为什么使用metaclass？</h2><p>为什么使用这种不起眼而且易出错的特性？  </p>
<blockquote>
<p>你根本不用关心metaclass，因为99%的人都用不上，如果你想知道你为什么用这个特性，那么你就是那99%中的一员…<br>如果你实在想知道，可以举一个使用metaclass的例子来说明一下:<br>在web框架django中，我们这样定义model:</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(maxlength=<span class="number">30</span>)</span><br><span class="line">    age = models.IntegerField()</span><br></pre></td></tr></table></figure>
<p>然后我这样使用model：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">guy = Person(name=<span class="string">"Jerry Young"</span>, age=<span class="number">23</span>)</span><br><span class="line">print(guy.age)    <span class="comment"># return 23 instead of models object</span></span><br></pre></td></tr></table></figure>
<p>定义时age是一个models.IntegerField对象，而打印出来却是一个int，这就是因为创建Person class对象时使用了metaclass做了一些操作。  </p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>1.你应该清楚class是对象，也可以用来创建对象；class本身就是metaclass的实例对象；python所有的东西都是对象，他们都是class或metaclass的实例，除了<code>type</code>；<code>type</code>是它自己的metaclass<br>2.你应该清楚metaclass是很复杂的，你可能不会想在简单的代码逻辑中使用它，你可以使用两种类似功能的技术：  </p>
<ul>
<li>monkey patching  </li>
<li>class decorators<br>99%的情况下你想修改class可以使用上述两种替代方案，但是99%的情况下你不需要修改class。  </li>
</ul>

      
       
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>




    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '',
            clientSecret: '',
            repo: 'youngziyi.github.io',
            owner: 'youngziyi',
            admin: ['youngziyi'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2020 oyzy</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#C','#读书笔记','#python','#应用技术','#raspberry','#epoll','#algorithm','#翻译',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
